!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports):"function"==typeof define&&define.amd?define(["exports"],factory):factory((global="undefined"!=typeof globalThis?globalThis:global||self).Zoldy={})}(this,(function(exports){"use strict";function _classCallCheck$1(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _typeof$1(obj){return _typeof$1="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof$1(obj)}function _toPropertyKey$1(arg){var key=function(input,hint){if("object"!==_typeof$1(input)||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0!==prim){var res=prim.call(input,hint||"default");if("object"!==_typeof$1(res))return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===hint?String:Number)(input)}(arg,"string");return"symbol"===_typeof$1(key)?key:String(key)}function _defineProperties$1(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,_toPropertyKey$1(descriptor.key),descriptor)}}function _createClass$1(Constructor,protoProps,staticProps){return protoProps&&_defineProperties$1(Constructor.prototype,protoProps),staticProps&&_defineProperties$1(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function _defineProperty$1(obj,key,value){return(key=_toPropertyKey$1(key))in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function _toPropertyKey(arg){var key=function(input,hint){if("object"!==_typeof(input)||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0!==prim){var res=prim.call(input,hint||"default");if("object"!==_typeof(res))return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===hint?String:Number)(input)}(arg,"string");return"symbol"===_typeof(key)?key:String(key)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function _defineProperty(obj,key,value){return(key=_toPropertyKey(key))in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function asyncGeneratorStep$1(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator$1(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep$1(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep$1(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function createCommonjsModule$1(fn){var module={exports:{}};return fn(module,module.exports),module.exports}var _typeof_1$1=createCommonjsModule$1((function(module){function _typeof(obj){return module.exports=_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},module.exports.__esModule=!0,module.exports.default=module.exports,_typeof(obj)}module.exports=_typeof,module.exports.__esModule=!0,module.exports.default=module.exports})),regeneratorRuntime$1$1=createCommonjsModule$1((function(module){var _typeof=_typeof_1$1.default;function _regeneratorRuntime(){module.exports=_regeneratorRuntime=function(){return exports},module.exports.__esModule=!0,module.exports.default=module.exports;var exports={},Op=Object.prototype,hasOwn=Op.hasOwnProperty,defineProperty=Object.defineProperty||function(obj,key,desc){obj[key]=desc.value},$Symbol="function"==typeof Symbol?Symbol:{},iteratorSymbol=$Symbol.iterator||"@@iterator",asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator",toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";function define(obj,key,value){return Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}),obj[key]}try{define({},"")}catch(err){define=function(obj,key,value){return obj[key]=value}}function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator,generator=Object.create(protoGenerator.prototype),context=new Context(tryLocsList||[]);return defineProperty(generator,"_invoke",{value:makeInvokeMethod(innerFn,self,context)}),generator}function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}exports.wrap=wrap;var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var IteratorPrototype={};define(IteratorPrototype,iteratorSymbol,(function(){return this}));var getProto=Object.getPrototypeOf,NativeIteratorPrototype=getProto&&getProto(getProto(values([])));NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)&&(IteratorPrototype=NativeIteratorPrototype);var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);function defineIteratorMethods(prototype){["next","throw","return"].forEach((function(method){define(prototype,method,(function(arg){return this._invoke(method,arg)}))}))}function AsyncIterator(generator,PromiseImpl){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if("throw"!==record.type){var result=record.arg,value=result.value;return value&&"object"==_typeof(value)&&hasOwn.call(value,"__await")?PromiseImpl.resolve(value.__await).then((function(value){invoke("next",value,resolve,reject)}),(function(err){invoke("throw",err,resolve,reject)})):PromiseImpl.resolve(value).then((function(unwrapped){result.value=unwrapped,resolve(result)}),(function(error){return invoke("throw",error,resolve,reject)}))}reject(record.arg)}var previousPromise;defineProperty(this,"_invoke",{value:function(method,arg){function callInvokeWithMethodAndArg(){return new PromiseImpl((function(resolve,reject){invoke(method,arg,resolve,reject)}))}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(innerFn,self,context){var state="suspendedStart";return function(method,arg){if("executing"===state)throw new Error("Generator is already running");if("completed"===state){if("throw"===method)throw arg;return doneResult()}for(context.method=method,context.arg=arg;;){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult}}if("next"===context.method)context.sent=context._sent=context.arg;else if("throw"===context.method){if("suspendedStart"===state)throw state="completed",context.arg;context.dispatchException(context.arg)}else"return"===context.method&&context.abrupt("return",context.arg);state="executing";var record=tryCatch(innerFn,self,context);if("normal"===record.type){if(state=context.done?"completed":"suspendedYield",record.arg===ContinueSentinel)continue;return{value:record.arg,done:context.done}}"throw"===record.type&&(state="completed",context.method="throw",context.arg=record.arg)}}}function maybeInvokeDelegate(delegate,context){var methodName=context.method,method=delegate.iterator[methodName];if(void 0===method)return context.delegate=null,"throw"===methodName&&delegate.iterator.return&&(context.method="return",context.arg=void 0,maybeInvokeDelegate(delegate,context),"throw"===context.method)||"return"!==methodName&&(context.method="throw",context.arg=new TypeError("The iterator does not provide a '"+methodName+"' method")),ContinueSentinel;var record=tryCatch(method,delegate.iterator,context.arg);if("throw"===record.type)return context.method="throw",context.arg=record.arg,context.delegate=null,ContinueSentinel;var info=record.arg;return info?info.done?(context[delegate.resultName]=info.value,context.next=delegate.nextLoc,"return"!==context.method&&(context.method="next",context.arg=void 0),context.delegate=null,ContinueSentinel):info:(context.method="throw",context.arg=new TypeError("iterator result is not an object"),context.delegate=null,ContinueSentinel)}function pushTryEntry(locs){var entry={tryLoc:locs[0]};1 in locs&&(entry.catchLoc=locs[1]),2 in locs&&(entry.finallyLoc=locs[2],entry.afterLoc=locs[3]),this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal",delete record.arg,entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}],tryLocsList.forEach(pushTryEntry,this),this.reset(!0)}function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod)return iteratorMethod.call(iterable);if("function"==typeof iterable.next)return iterable;if(!isNaN(iterable.length)){var i=-1,next=function next(){for(;++i<iterable.length;)if(hasOwn.call(iterable,i))return next.value=iterable[i],next.done=!1,next;return next.value=void 0,next.done=!0,next};return next.next=next}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,defineProperty(Gp,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),defineProperty(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,toStringTagSymbol,"GeneratorFunction"),exports.isGeneratorFunction=function(genFun){var ctor="function"==typeof genFun&&genFun.constructor;return!!ctor&&(ctor===GeneratorFunction||"GeneratorFunction"===(ctor.displayName||ctor.name))},exports.mark=function(genFun){return Object.setPrototypeOf?Object.setPrototypeOf(genFun,GeneratorFunctionPrototype):(genFun.__proto__=GeneratorFunctionPrototype,define(genFun,toStringTagSymbol,"GeneratorFunction")),genFun.prototype=Object.create(Gp),genFun},exports.awrap=function(arg){return{__await:arg}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,asyncIteratorSymbol,(function(){return this})),exports.AsyncIterator=AsyncIterator,exports.async=function(innerFn,outerFn,self,tryLocsList,PromiseImpl){void 0===PromiseImpl&&(PromiseImpl=Promise);var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList),PromiseImpl);return exports.isGeneratorFunction(outerFn)?iter:iter.next().then((function(result){return result.done?result.value:iter.next()}))},defineIteratorMethods(Gp),define(Gp,toStringTagSymbol,"Generator"),define(Gp,iteratorSymbol,(function(){return this})),define(Gp,"toString",(function(){return"[object Generator]"})),exports.keys=function(val){var object=Object(val),keys=[];for(var key in object)keys.push(key);return keys.reverse(),function next(){for(;keys.length;){var key=keys.pop();if(key in object)return next.value=key,next.done=!1,next}return next.done=!0,next}},exports.values=values,Context.prototype={constructor:Context,reset:function(skipTempReset){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!skipTempReset)for(var name in this)"t"===name.charAt(0)&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))&&(this[name]=void 0)},stop:function(){this.done=!0;var rootRecord=this.tryEntries[0].completion;if("throw"===rootRecord.type)throw rootRecord.arg;return this.rval},dispatchException:function(exception){if(this.done)throw exception;var context=this;function handle(loc,caught){return record.type="throw",record.arg=exception,context.next=loc,caught&&(context.method="next",context.arg=void 0),!!caught}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i],record=entry.completion;if("root"===entry.tryLoc)return handle("end");if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc"),hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0)}else{if(!hasFinally)throw new Error("try statement without catch or finally");if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}}}},abrupt:function(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}finallyEntry&&("break"===type||"continue"===type)&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc&&(finallyEntry=null);var record=finallyEntry?finallyEntry.completion:{};return record.type=type,record.arg=arg,finallyEntry?(this.method="next",this.next=finallyEntry.finallyLoc,ContinueSentinel):this.complete(record)},complete:function(record,afterLoc){if("throw"===record.type)throw record.arg;return"break"===record.type||"continue"===record.type?this.next=record.arg:"return"===record.type?(this.rval=this.arg=record.arg,this.method="return",this.next="end"):"normal"===record.type&&afterLoc&&(this.next=afterLoc),ContinueSentinel},finish:function(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc)return this.complete(entry.completion,entry.afterLoc),resetTryEntry(entry),ContinueSentinel}},catch:function(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if("throw"===record.type){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function(iterable,resultName,nextLoc){return this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc},"next"===this.method&&(this.arg=void 0),ContinueSentinel}},exports}module.exports=_regeneratorRuntime,module.exports.__esModule=!0,module.exports.default=module.exports})),runtime$1=regeneratorRuntime$1$1(),regenerator$1=runtime$1;try{regeneratorRuntime=runtime$1}catch(accidentalStrictMode){"object"==typeof globalThis?globalThis.regeneratorRuntime=runtime$1:Function("r","regeneratorRuntime = r")(runtime$1)}var WrappedValue_OPAQUE=Symbol(),Void=Symbol();function _arrayLikeToArray$2(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _iterableToArray$1(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}function _unsupportedIterableToArray$2(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray$2(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$2(o,minLen):void 0}}function _toConsumableArray$1(arr){return function(arr){if(Array.isArray(arr))return _arrayLikeToArray$2(arr)}(arr)||_iterableToArray$1(arr)||_unsupportedIterableToArray$2(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _toArray$1(arr){return function(arr){if(Array.isArray(arr))return arr}(arr)||_iterableToArray$1(arr)||_unsupportedIterableToArray$2(arr)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _asyncIterator(iterable){var method,async,sync,retry=2;for("undefined"!=typeof Symbol&&(async=Symbol.asyncIterator,sync=Symbol.iterator);retry--;){if(async&&null!=(method=iterable[async]))return method.call(iterable);if(sync&&null!=(method=iterable[sync]))return new AsyncFromSyncIterator(method.call(iterable));async="@@asyncIterator",sync="@@iterator"}throw new TypeError("Object is not async iterable")}function AsyncFromSyncIterator(s){function AsyncFromSyncIteratorContinuation(r){if(Object(r)!==r)return Promise.reject(new TypeError(r+" is not an object."));var done=r.done;return Promise.resolve(r.value).then((function(value){return{value:value,done:done}}))}return AsyncFromSyncIterator=function(s){this.s=s,this.n=s.next},AsyncFromSyncIterator.prototype={s:null,n:null,next:function(){return AsyncFromSyncIteratorContinuation(this.n.apply(this.s,arguments))},return:function(value){var ret=this.s.return;return void 0===ret?Promise.resolve({value:value,done:!0}):AsyncFromSyncIteratorContinuation(ret.apply(this.s,arguments))},throw:function(value){var thr=this.s.return;return void 0===thr?Promise.reject(value):AsyncFromSyncIteratorContinuation(thr.apply(this.s,arguments))}},new AsyncFromSyncIterator(s)}var fromAsyncIterator=function(execute){return new RakunSourceBuildImpl(execute)},fromCallback=function(){for(var _len=arguments.length,callbacks=new Array(_len),_key=0;_key<_len;_key++)callbacks[_key]=arguments[_key];return fromAsyncIterator((function(ctx){var values=null;return _defineProperty({},Symbol.asyncIterator,(function(){var asyncIterator={next:function(){return _asyncToGenerator$1(regenerator$1.mark((function _callee(){var _values2,value,rest;return regenerator$1.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(values){_context.next=4;break}return _context.next=3,Promise.resolve(callbacks.map((function(callback){return Promise.resolve(callback(ctx))}))).then((function(a){return Promise.all(a)})).then((function(a){return Promise.all(a.flat().map((function(e){return Promise.resolve(e)})))}));case 3:values=_context.sent;case 4:if(values&&0!=values.length){_context.next=6;break}return _context.abrupt("return",{done:!0,value:null});case 6:return _values2=_toArray$1(values),value=_values2[0],rest=_values2.slice(1),values=rest,_context.abrupt("return",{done:!1,value:value});case 9:case"end":return _context.stop()}}),_callee)})))()}};return asyncIterator}))}))},RakunSourceBuildImpl=function(){function RakunSourceBuildImpl(calback){_classCallCheck(this,RakunSourceBuildImpl),this.calback=calback,_defineProperty(this,WrappedValue_OPAQUE,"sourceBuild")}var _block,_blockFirst;return _createClass(RakunSourceBuildImpl,[{key:"switchIfEmpty",value:function(source){var _this=this;return fromAsyncIterator((function(ctx){var it=_this.asyncIterator(ctx),index=0;return _defineProperty({},Symbol.asyncIterator,(function(){return{next:function(){return _asyncToGenerator$1(regenerator$1.mark((function _callee2(){var item;return regenerator$1.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,it.next();case 2:if(!(item=_context2.sent).done||0!=index){_context2.next=8;break}return it=source.asyncIterator(ctx),_context2.next=7,it.next();case 7:item=_context2.sent;case 8:return index++,_context2.abrupt("return",item);case 10:case"end":return _context2.stop()}}),_callee2)})))()}}}))}))}},{key:"defaultIfEmpty",value:function(value){return this.switchIfEmpty(fromCallback((function(){return[value]})))}},{key:"zip",value:function(){for(var _this2=this,_len2=arguments.length,sources=new Array(_len2),_key2=0;_key2<_len2;_key2++)sources[_key2]=arguments[_key2];return fromAsyncIterator((function(ctx){var it=_this2.asyncIterator(ctx);return _defineProperty({},Symbol.asyncIterator,(function(){return{next:function(){return _asyncToGenerator$1(regenerator$1.mark((function _callee3(){var item,value;return regenerator$1.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,it.next();case 2:if(!(item=_context3.sent).done){_context3.next=5;break}return _context3.abrupt("return",item);case 5:return _context3.t0=[item.value],_context3.t1=_toConsumableArray$1,_context3.next=9,Promise.all(sources.map((function(source){return source.asyncIterator(ctx).next()}))).then((function(array){return array.map((function(item){return item.done?null:item.value}))}));case 9:return _context3.t2=_context3.sent,_context3.t3=(0,_context3.t1)(_context3.t2),value=_context3.t0.concat.call(_context3.t0,_context3.t3),_context3.abrupt("return",{done:item.done,value:value});case 13:case"end":return _context3.stop()}}),_callee3)})))()}}}))}))}},{key:"zipWhen",value:function(){for(var _this3=this,_len3=arguments.length,sourceFns=new Array(_len3),_key3=0;_key3<_len3;_key3++)sourceFns[_key3]=arguments[_key3];return fromAsyncIterator((function(ctx){var it=_this3.asyncIterator(ctx);return _defineProperty({},Symbol.asyncIterator,(function(){var asyncIterator={next:function(){return _asyncToGenerator$1(regenerator$1.mark((function _callee4(){var item,value;return regenerator$1.wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,it.next();case 2:if(!(item=_context4.sent).done){_context4.next=5;break}return _context4.abrupt("return",item);case 5:return _context4.t0=[item.value],_context4.t1=_toConsumableArray$1,_context4.next=9,Promise.all(sourceFns.map((function(fn){return fn(item.value).asyncIterator(ctx).next()}))).then((function(array){return array.map((function(item){return item.done?null:item.value}))}));case 9:return _context4.t2=_context4.sent,_context4.t3=(0,_context4.t1)(_context4.t2),value=_context4.t0.concat.call(_context4.t0,_context4.t3),_context4.abrupt("return",{done:item.done,value:value});case 13:case"end":return _context4.stop()}}),_callee4)})))()}};return asyncIterator}))}))}},{key:"flatFilter",value:function(fn){var _this4=this;return fromAsyncIterator((function(ctx){var it=_this4.asyncIterator(ctx);return _defineProperty({},Symbol.asyncIterator,(function(){var asyncIterator={next:function(){return _asyncToGenerator$1(regenerator$1.mark((function _callee5(){var item;return regenerator$1.wrap((function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=2,it.next();case 2:if(!(item=_context5.sent).done){_context5.next=5;break}return _context5.abrupt("return",item);case 5:return _context5.next=7,fn(item.value).asyncIterator(ctx);case 7:return _context5.next=9,_context5.sent.next();case 9:if(_context5.sent.value){_context5.next=14;break}return _context5.next=13,asyncIterator.next();case 13:return _context5.abrupt("return",_context5.sent);case 14:return _context5.abrupt("return",item);case 15:case"end":return _context5.stop()}}),_callee5)})))()}};return asyncIterator}))}))}},{key:"filter",value:function(fn){var _this5=this;return fromAsyncIterator((function(ctx){var it=_this5.asyncIterator(ctx);return _defineProperty({},Symbol.asyncIterator,(function(){var asyncIterator={next:function(){return _asyncToGenerator$1(regenerator$1.mark((function _callee6(){var item;return regenerator$1.wrap((function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _context6.next=2,it.next();case 2:if(!(item=_context6.sent).done){_context6.next=5;break}return _context6.abrupt("return",item);case 5:if(fn(item.value)){_context6.next=10;break}return _context6.next=9,asyncIterator.next();case 9:return _context6.abrupt("return",_context6.sent);case 10:return _context6.abrupt("return",item);case 11:case"end":return _context6.stop()}}),_callee6)})))()}};return asyncIterator}))}))}},{key:"thenReturn",value:function(value){var sourceOld=this;return fromAsyncIterator((function(ctx){var finish=!1;return _defineProperty({},Symbol.asyncIterator,(function(){return{next:function(){return _asyncToGenerator$1(regenerator$1.mark((function _callee7(){return regenerator$1.wrap((function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:if(finish){_context7.next=5;break}return finish=!0,_context7.next=4,sourceOld.block(ctx);case 4:return _context7.abrupt("return",{value:value});case 5:return _context7.abrupt("return",{done:!0,value:null});case 6:case"end":return _context7.stop()}}),_callee7)})))()}}}))}))}},{key:"then",value:function(source){if(!source)return this.thenReturn(Void);var sourceOld=this;return fromAsyncIterator((function(ctx){var finish=!1,it2=source.asyncIterator(ctx);return _defineProperty({},Symbol.asyncIterator,(function(){return{next:function(){return _asyncToGenerator$1(regenerator$1.mark((function _callee8(){var item2;return regenerator$1.wrap((function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:if(finish){_context8.next=4;break}return finish=!0,_context8.next=4,sourceOld.block(ctx);case 4:return _context8.next=6,it2.next();case 6:if(!(item2=_context8.sent).done){_context8.next=9;break}return _context8.abrupt("return",item2);case 9:return _context8.abrupt("return",item2);case 10:case"end":return _context8.stop()}}),_callee8)})))()}}}))}))}},{key:"onErrorResume",value:function(errorType,fn){var _this6=this;return fromAsyncIterator((function(ctx){return _defineProperty({},Symbol.asyncIterator,(function(){var iterator=_this6.asyncIterator(ctx);return{next:function(){return _asyncToGenerator$1(regenerator$1.mark((function _callee9(){return regenerator$1.wrap((function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:return _context9.prev=0,_context9.next=3,iterator.next();case 3:case 11:return _context9.abrupt("return",_context9.sent);case 6:if(_context9.prev=6,_context9.t0=_context9.catch(0),!(_context9.t0 instanceof errorType)){_context9.next=12;break}return _context9.next=11,fn(_context9.t0).asyncIterator(ctx).next();case 12:throw _context9.t0;case 13:case"end":return _context9.stop()}}),_callee9,null,[[0,6]])})))()}}}))}))}},{key:"doOnNext",value:function(handler){var _this7=this;return fromAsyncIterator((function(ctx){return _defineProperty({},Symbol.asyncIterator,(function(){var iterator=_this7.asyncIterator(ctx);return{next:function(){return _asyncToGenerator$1(regenerator$1.mark((function _callee10(){var item;return regenerator$1.wrap((function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:return _context10.next=2,iterator.next();case 2:return(item=_context10.sent).done||handler(item.value),_context10.abrupt("return",item);case 5:case"end":return _context10.stop()}}),_callee10)})))()}}}))}))}},{key:"doOnError",value:function(handler){var _this8=this;return fromAsyncIterator((function(ctx){var it=_this8.asyncIterator(ctx);return _defineProperty({},Symbol.asyncIterator,(function(){return{next:function(){return _asyncToGenerator$1(regenerator$1.mark((function _callee11(){return regenerator$1.wrap((function(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:return _context11.prev=0,_context11.next=3,it.next();case 3:return _context11.abrupt("return",_context11.sent);case 6:throw _context11.prev=6,_context11.t0=_context11.catch(0),handler(_context11.t0),_context11.t0;case 10:case"end":return _context11.stop()}}),_callee11,null,[[0,6]])})))()}}}))}))}},{key:"pipe",value:function(fn){var _this9=this;return fromAsyncIterator((function(ctx){return _defineProperty({},Symbol.asyncIterator,(function(){var it=_this9.asyncIterator(ctx);return{next:function(){return _asyncToGenerator$1(regenerator$1.mark((function _callee12(){var item;return regenerator$1.wrap((function(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:return _context12.next=2,it.next();case 2:if(!(item=_context12.sent).done){_context12.next=5;break}return _context12.abrupt("return",item);case 5:return _context12.t0=item.done,_context12.next=8,fn(item.value);case 8:return _context12.t1=_context12.sent,_context12.abrupt("return",{done:_context12.t0,value:_context12.t1});case 10:case"end":return _context12.stop()}}),_callee12)})))()}}}))}))}},{key:"flatPipe",value:function(fn){var _this10=this;return fromAsyncIterator((function(ctx){return _defineProperty({},Symbol.asyncIterator,(function(){var iterator=_this10.asyncIterator(ctx),item=null,iterator2=null,asyncIterator={next:function(){return _asyncToGenerator$1(regenerator$1.mark((function _callee13(){var item2;return regenerator$1.wrap((function(_context13){for(;;)switch(_context13.prev=_context13.next){case 0:if(null!=item){_context13.next=4;break}return _context13.next=3,iterator.next();case 3:item=_context13.sent;case 4:if(!item.done){_context13.next=6;break}return _context13.abrupt("return",{done:!0,value:item.value});case 6:return null==iterator2&&(iterator2=fn(item.value).asyncIterator(ctx)),_context13.next=9,iterator2.next();case 9:if(!(item2=_context13.sent).done){_context13.next=18;break}return iterator2=null,item=null,_context13.next=15,asyncIterator.next();case 15:return _context13.abrupt("return",_context13.sent);case 18:return _context13.abrupt("return",{done:item2.done,value:item2.value});case 19:case"end":return _context13.stop()}}),_callee13)})))()}};return asyncIterator}))}))}},{key:"blockFirst",value:(_blockFirst=_asyncToGenerator$1(regenerator$1.mark((function _callee14(contextManager){var array;return regenerator$1.wrap((function(_context14){for(;;)switch(_context14.prev=_context14.next){case 0:return _context14.next=2,this.block(contextManager);case 2:return array=_context14.sent,_context14.abrupt("return",array[0]);case 4:case"end":return _context14.stop()}}),_callee14,this)}))),function(_x){return _blockFirst.apply(this,arguments)})},{key:"block",value:(_block=_asyncToGenerator$1(regenerator$1.mark((function _callee15(contextManager){var arr,_iteratorAbruptCompletion,_didIteratorError,_iteratorError,_iterator,_step,i;return regenerator$1.wrap((function(_context15){for(;;)switch(_context15.prev=_context15.next){case 0:return arr=[],_iteratorAbruptCompletion=!1,_didIteratorError=!1,_context15.prev=3,_context15.t0=_asyncIterator,_context15.next=7,this.calback(contextManager);case 7:_context15.t1=_context15.sent,_iterator=(0,_context15.t0)(_context15.t1);case 9:return _context15.next=11,_iterator.next();case 11:if(!(_iteratorAbruptCompletion=!(_step=_context15.sent).done)){_context15.next=17;break}i=_step.value,arr.push(i);case 14:_iteratorAbruptCompletion=!1,_context15.next=9;break;case 17:_context15.next=23;break;case 19:_context15.prev=19,_context15.t2=_context15.catch(3),_didIteratorError=!0,_iteratorError=_context15.t2;case 23:if(_context15.prev=23,_context15.prev=24,!_iteratorAbruptCompletion||null==_iterator.return){_context15.next=28;break}return _context15.next=28,_iterator.return();case 28:if(_context15.prev=28,!_didIteratorError){_context15.next=31;break}throw _iteratorError;case 31:return _context15.finish(28);case 32:return _context15.finish(23);case 33:return _context15.abrupt("return",arr);case 34:case"end":return _context15.stop()}}),_callee15,this,[[3,19,23,33],[24,,28,32]])}))),function(_x2){return _block.apply(this,arguments)})},{key:"asyncIterator",value:function(ctx){return this.calback(ctx)[Symbol.asyncIterator]()}}]),RakunSourceBuildImpl}(),StaticSourceBuildImpl=function(){function StaticSourceBuildImpl(){_classCallCheck(this,StaticSourceBuildImpl),_defineProperty(this,"fromCallback",fromCallback)}return _createClass(StaticSourceBuildImpl,[{key:"just",value:function(){for(var _len=arguments.length,promises=new Array(_len),_key=0;_key<_len;_key++)promises[_key]=arguments[_key];return fromCallback((function(){return promises}))}},{key:"fromArray",value:function(values){return fromCallback((function(){return values}))}},{key:"then",value:function(){return fromCallback((function(){return[Void]}))}},{key:"empty",value:function(){return fromCallback((function(){return[]}))}},{key:"zip",value:function(){for(var _len2=arguments.length,sources=new Array(_len2),_key2=0;_key2<_len2;_key2++)sources[_key2]=arguments[_key2];return fromAsyncIterator((function(ctx){var finish=!1;return _defineProperty({},Symbol.asyncIterator,(function(){return{next:function(){return _asyncToGenerator$1(regenerator$1.mark((function _callee(){var value;return regenerator$1.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(finish){_context.next=6;break}return finish=!0,_context.next=4,Promise.all(sources.map((function(source){return source.asyncIterator(ctx).next()}))).then((function(array){return array.map((function(item){return item.done?null:item.value}))}));case 4:return value=_context.sent,_context.abrupt("return",{done:!1,value:value});case 6:return _context.abrupt("return",{done:!0,value:null});case 7:case"end":return _context.stop()}}),_callee)})))()}}}))}))}},{key:"error",value:function(_error){return fromCallback(_asyncToGenerator$1(regenerator$1.mark((function _callee2(){return regenerator$1.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:throw _error;case 1:case"end":return _context2.stop()}}),_callee2)}))))}}]),StaticSourceBuildImpl}(),sourceBuild$1=new StaticSourceBuildImpl,RakunContextManagerImpl=function(){function RakunContextManagerImpl(){_classCallCheck(this,RakunContextManagerImpl),_defineProperty(this,"items",[])}return _createClass(RakunContextManagerImpl,[{key:"getValue",value:function(context){var _this$items$filter$;return Promise.resolve(null===(_this$items$filter$=this.items.filter((function(item){return item.context===context}))[0])||void 0===_this$items$filter$?void 0:_this$items$filter$.value)}},{key:"setValue",value:function(context,value){return this.items=[].concat(_toConsumableArray$1(this.items.filter((function(item){return item.context!=context}))),[{context:context,value:value}]),Promise.resolve(Void)}}]),RakunContextManagerImpl}(),RakunMonoImpl=function(){function RakunMonoImpl(sourceBuild){_classCallCheck(this,RakunMonoImpl),this.sourceBuild=sourceBuild,_defineProperty(this,WrappedValue_OPAQUE,"mono")}return _createClass(RakunMonoImpl,[{key:"flatPipeMany",value:function(fn){return fromSourceBuild(this.sourceBuild.flatPipe(fn))}},{key:"then",value:function(source){return source?"flux"==source[WrappedValue_OPAQUE]?fromSourceBuild(this.sourceBuild.then(source)):fromSourceBuild$1(this.sourceBuild.then(source)):fromSourceBuild$1(this.sourceBuild.then())}},{key:"asyncIterator",value:function(ctx){return this.sourceBuild.asyncIterator(ctx)}},{key:"onErrorResume",value:function(errorType,fn){return fromSourceBuild$1(this.sourceBuild.onErrorResume(errorType,fn))}},{key:"doOnNext",value:function(handler){return fromSourceBuild$1(this.sourceBuild.doOnNext(handler))}},{key:"doOnError",value:function(handler){return fromSourceBuild$1(this.sourceBuild.doOnError(handler))}},{key:"switchIfEmpty",value:function(source){return fromSourceBuild$1(this.sourceBuild.switchIfEmpty(source))}},{key:"defaultIfEmpty",value:function(value){return fromSourceBuild$1(this.sourceBuild.defaultIfEmpty(value))}},{key:"zipWhen",value:function(){var _this$sourceBuild;return fromSourceBuild$1((_this$sourceBuild=this.sourceBuild).zipWhen.apply(_this$sourceBuild,arguments))}},{key:"zip",value:function(){var _this$sourceBuild2;return fromSourceBuild$1((_this$sourceBuild2=this.sourceBuild).zip.apply(_this$sourceBuild2,arguments))}},{key:"pipe",value:function(fn){return fromSourceBuild$1(this.sourceBuild.pipe(fn))}},{key:"flatPipe",value:function(fn){return fromSourceBuild$1(this.sourceBuild.flatPipe(fn))}},{key:"thenReturn",value:function(value){return fromSourceBuild$1(this.sourceBuild.thenReturn(value))}},{key:"filter",value:function(fn){return fromSourceBuild$1(this.sourceBuild.filter(fn))}},{key:"flatFilter",value:function(fn){return fromSourceBuild$1(this.sourceBuild.flatFilter(fn))}},{key:"blockFirst",value:function(contextManager){return this.sourceBuild.blockFirst(null!=contextManager?contextManager:new RakunContextManagerImpl)}},{key:"block",value:function(contextManager){return this.sourceBuild.block(contextManager)}}]),RakunMonoImpl}(),fromSourceBuild$1=function(sourceBuild){return new RakunMonoImpl(sourceBuild)},RakunFluxImpl=function(){function RakunFluxImpl(sourceBuild){_classCallCheck(this,RakunFluxImpl),this.sourceBuild=sourceBuild,_defineProperty(this,WrappedValue_OPAQUE,"flux")}return _createClass(RakunFluxImpl,[{key:"then",value:function(source){return source?"mono"==source[WrappedValue_OPAQUE]?fromSourceBuild$1(this.sourceBuild.then(source)):fromSourceBuild(this.sourceBuild.then(source)):fromSourceBuild$1(this.sourceBuild.then())}},{key:"array",value:function(){var _this=this;return fromSourceBuild$1(sourceBuild$1.fromCallback(function(){var _ref=_asyncToGenerator$1(regenerator$1.mark((function _callee(ctx){return regenerator$1.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,_this.sourceBuild.block(ctx);case 2:return _context.t0=_context.sent,_context.abrupt("return",[_context.t0]);case 4:case"end":return _context.stop()}}),_callee)})));return function(_x){return _ref.apply(this,arguments)}}()))}},{key:"switchIfEmpty",value:function(source){return fromSourceBuild(this.sourceBuild.switchIfEmpty(source))}},{key:"defaultIfEmpty",value:function(value){return fromSourceBuild(this.sourceBuild.defaultIfEmpty(value))}},{key:"onErrorResume",value:function(errorType,fn){return fromSourceBuild(this.sourceBuild.onErrorResume(errorType,fn))}},{key:"doOnNext",value:function(handler){return fromSourceBuild(this.sourceBuild.doOnNext(handler))}},{key:"doOnError",value:function(handler){return fromSourceBuild(this.sourceBuild.doOnError(handler))}},{key:"zipWhen",value:function(){var _this$sourceBuild;return fromSourceBuild((_this$sourceBuild=this.sourceBuild).zipWhen.apply(_this$sourceBuild,arguments))}},{key:"zip",value:function(){var _this$sourceBuild2;return fromSourceBuild((_this$sourceBuild2=this.sourceBuild).zip.apply(_this$sourceBuild2,arguments))}},{key:"pipe",value:function(fn){return fromSourceBuild(this.sourceBuild.pipe(fn))}},{key:"flatPipe",value:function(fn){return fromSourceBuild(this.sourceBuild.flatPipe(fn))}},{key:"filter",value:function(fn){return fromSourceBuild(this.sourceBuild.filter(fn))}},{key:"flatFilter",value:function(fn){return fromSourceBuild(this.sourceBuild.flatFilter(fn))}},{key:"thenReturn",value:function(value){return fromSourceBuild(this.sourceBuild.thenReturn(value))}},{key:"blockFirst",value:function(contextManager){return this.sourceBuild.blockFirst(null!=contextManager?contextManager:new RakunContextManagerImpl)}},{key:"block",value:function(contextManager){return this.sourceBuild.block(contextManager)}},{key:"asyncIterator",value:function(ctx){return this.sourceBuild.asyncIterator(ctx)}}]),RakunFluxImpl}(),fromSourceBuild=function(sourceBuild){return new RakunFluxImpl(sourceBuild)},RakunStaticFluxImpl=function(){function RakunStaticFluxImpl(){_classCallCheck(this,RakunStaticFluxImpl),_defineProperty(this,"fromSourceBuild",fromSourceBuild)}return _createClass(RakunStaticFluxImpl,[{key:"fromCallback",value:function(){return fromSourceBuild(sourceBuild$1.fromCallback.apply(sourceBuild$1,arguments))}},{key:"fromPromise",value:function(promise){return fromSourceBuild(sourceBuild$1.fromArray(promise))}},{key:"fromArray",value:function(values){return fromSourceBuild(sourceBuild$1.fromArray(values))}},{key:"just",value:function(){for(var _len=arguments.length,values=new Array(_len),_key=0;_key<_len;_key++)values[_key]=arguments[_key];return fromSourceBuild(sourceBuild$1.fromArray(values))}}]),RakunStaticFluxImpl}(),flux$1=new RakunStaticFluxImpl,StaticMonoImpl=function(){function StaticMonoImpl(){_classCallCheck(this,StaticMonoImpl),_defineProperty(this,"fromSourceBuild",fromSourceBuild$1)}return _createClass(StaticMonoImpl,[{key:"fromCallback",value:function(){for(var _len=arguments.length,callbacks=new Array(_len),_key=0;_key<_len;_key++)callbacks[_key]=arguments[_key];return fromSourceBuild$1(sourceBuild$1.fromCallback.apply(sourceBuild$1,_toConsumableArray$1(callbacks.map((function(callback){return function(ctx){return Promise.all([callback(ctx)])}})))))}},{key:"then",value:function(){return this.fromSourceBuild(sourceBuild$1.then())}},{key:"empty",value:function(){return this.fromSourceBuild(sourceBuild$1.empty())}},{key:"zip",value:function(){return this.fromSourceBuild(sourceBuild$1.zip.apply(sourceBuild$1,arguments))}},{key:"just",value:function(value){return this.fromSourceBuild(sourceBuild$1.just(value))}},{key:"fromPromise",value:function(promise){return this.fromSourceBuild(sourceBuild$1.just(promise))}},{key:"error",value:function(_error){return this.fromSourceBuild(sourceBuild$1.error(_error))}}]),StaticMonoImpl}(),mono$1=new StaticMonoImpl,RakunContextImpl=function(){function RakunContextImpl(defualtValue){_classCallCheck(this,RakunContextImpl),this.defualtValue=defualtValue}return _createClass(RakunContextImpl,[{key:"get",value:function(){var _this=this;return mono$1.fromCallback((function(ctx){return ctx.getValue(_this)}))}},{key:"define",value:function(value){var _this2=this;return mono$1.fromCallback((function(ctx){return ctx.setValue(_this2,value)}))}}]),RakunContextImpl}(),context$1=new(function(){function RakunStaticContextImpl(){_classCallCheck(this,RakunStaticContextImpl)}return _createClass(RakunStaticContextImpl,[{key:"create",value:function(value){return new RakunContextImpl(value)}}]),RakunStaticContextImpl}()),flux=flux$1,mono=mono$1,context=context$1,zoldyPathParentProvider=context.create(null),zoldySnapshotProvider=context.create(null);function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _arrayLikeToArray$1(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _unsupportedIterableToArray$1(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray$1(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$1(o,minLen):void 0}}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _s,_e,_x,_r,_arr=[],_n=!0,_d=!1;try{if(_x=(_i=_i.call(arr)).next,0===i){if(Object(_i)!==_i)return;_n=!1}else for(;!(_n=(_s=_x.call(_i)).done)&&(_arr.push(_s.value),_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{if(!_n&&null!=_i.return&&(_r=_i.return(),Object(_r)!==_r))return}finally{if(_d)throw _e}}return _arr}}(arr,i)||_unsupportedIterableToArray$1(arr,i)||_nonIterableRest()}function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return _arrayLikeToArray$1(arr)}(arr)||_iterableToArray(arr)||_unsupportedIterableToArray$1(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function createCommonjsModule(fn){var module={exports:{}};return fn(module,module.exports),module.exports}var _typeof_1=createCommonjsModule((function(module){function _typeof(obj){return module.exports=_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},module.exports.__esModule=!0,module.exports.default=module.exports,_typeof(obj)}module.exports=_typeof,module.exports.__esModule=!0,module.exports.default=module.exports})),regeneratorRuntime$1=createCommonjsModule((function(module){var _typeof=_typeof_1.default;function _regeneratorRuntime(){module.exports=_regeneratorRuntime=function(){return exports},module.exports.__esModule=!0,module.exports.default=module.exports;var exports={},Op=Object.prototype,hasOwn=Op.hasOwnProperty,defineProperty=Object.defineProperty||function(obj,key,desc){obj[key]=desc.value},$Symbol="function"==typeof Symbol?Symbol:{},iteratorSymbol=$Symbol.iterator||"@@iterator",asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator",toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";function define(obj,key,value){return Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}),obj[key]}try{define({},"")}catch(err){define=function(obj,key,value){return obj[key]=value}}function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator,generator=Object.create(protoGenerator.prototype),context=new Context(tryLocsList||[]);return defineProperty(generator,"_invoke",{value:makeInvokeMethod(innerFn,self,context)}),generator}function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}exports.wrap=wrap;var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var IteratorPrototype={};define(IteratorPrototype,iteratorSymbol,(function(){return this}));var getProto=Object.getPrototypeOf,NativeIteratorPrototype=getProto&&getProto(getProto(values([])));NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)&&(IteratorPrototype=NativeIteratorPrototype);var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);function defineIteratorMethods(prototype){["next","throw","return"].forEach((function(method){define(prototype,method,(function(arg){return this._invoke(method,arg)}))}))}function AsyncIterator(generator,PromiseImpl){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if("throw"!==record.type){var result=record.arg,value=result.value;return value&&"object"==_typeof(value)&&hasOwn.call(value,"__await")?PromiseImpl.resolve(value.__await).then((function(value){invoke("next",value,resolve,reject)}),(function(err){invoke("throw",err,resolve,reject)})):PromiseImpl.resolve(value).then((function(unwrapped){result.value=unwrapped,resolve(result)}),(function(error){return invoke("throw",error,resolve,reject)}))}reject(record.arg)}var previousPromise;defineProperty(this,"_invoke",{value:function(method,arg){function callInvokeWithMethodAndArg(){return new PromiseImpl((function(resolve,reject){invoke(method,arg,resolve,reject)}))}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(innerFn,self,context){var state="suspendedStart";return function(method,arg){if("executing"===state)throw new Error("Generator is already running");if("completed"===state){if("throw"===method)throw arg;return doneResult()}for(context.method=method,context.arg=arg;;){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult}}if("next"===context.method)context.sent=context._sent=context.arg;else if("throw"===context.method){if("suspendedStart"===state)throw state="completed",context.arg;context.dispatchException(context.arg)}else"return"===context.method&&context.abrupt("return",context.arg);state="executing";var record=tryCatch(innerFn,self,context);if("normal"===record.type){if(state=context.done?"completed":"suspendedYield",record.arg===ContinueSentinel)continue;return{value:record.arg,done:context.done}}"throw"===record.type&&(state="completed",context.method="throw",context.arg=record.arg)}}}function maybeInvokeDelegate(delegate,context){var methodName=context.method,method=delegate.iterator[methodName];if(void 0===method)return context.delegate=null,"throw"===methodName&&delegate.iterator.return&&(context.method="return",context.arg=void 0,maybeInvokeDelegate(delegate,context),"throw"===context.method)||"return"!==methodName&&(context.method="throw",context.arg=new TypeError("The iterator does not provide a '"+methodName+"' method")),ContinueSentinel;var record=tryCatch(method,delegate.iterator,context.arg);if("throw"===record.type)return context.method="throw",context.arg=record.arg,context.delegate=null,ContinueSentinel;var info=record.arg;return info?info.done?(context[delegate.resultName]=info.value,context.next=delegate.nextLoc,"return"!==context.method&&(context.method="next",context.arg=void 0),context.delegate=null,ContinueSentinel):info:(context.method="throw",context.arg=new TypeError("iterator result is not an object"),context.delegate=null,ContinueSentinel)}function pushTryEntry(locs){var entry={tryLoc:locs[0]};1 in locs&&(entry.catchLoc=locs[1]),2 in locs&&(entry.finallyLoc=locs[2],entry.afterLoc=locs[3]),this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal",delete record.arg,entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}],tryLocsList.forEach(pushTryEntry,this),this.reset(!0)}function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod)return iteratorMethod.call(iterable);if("function"==typeof iterable.next)return iterable;if(!isNaN(iterable.length)){var i=-1,next=function next(){for(;++i<iterable.length;)if(hasOwn.call(iterable,i))return next.value=iterable[i],next.done=!1,next;return next.value=void 0,next.done=!0,next};return next.next=next}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,defineProperty(Gp,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),defineProperty(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,toStringTagSymbol,"GeneratorFunction"),exports.isGeneratorFunction=function(genFun){var ctor="function"==typeof genFun&&genFun.constructor;return!!ctor&&(ctor===GeneratorFunction||"GeneratorFunction"===(ctor.displayName||ctor.name))},exports.mark=function(genFun){return Object.setPrototypeOf?Object.setPrototypeOf(genFun,GeneratorFunctionPrototype):(genFun.__proto__=GeneratorFunctionPrototype,define(genFun,toStringTagSymbol,"GeneratorFunction")),genFun.prototype=Object.create(Gp),genFun},exports.awrap=function(arg){return{__await:arg}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,asyncIteratorSymbol,(function(){return this})),exports.AsyncIterator=AsyncIterator,exports.async=function(innerFn,outerFn,self,tryLocsList,PromiseImpl){void 0===PromiseImpl&&(PromiseImpl=Promise);var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList),PromiseImpl);return exports.isGeneratorFunction(outerFn)?iter:iter.next().then((function(result){return result.done?result.value:iter.next()}))},defineIteratorMethods(Gp),define(Gp,toStringTagSymbol,"Generator"),define(Gp,iteratorSymbol,(function(){return this})),define(Gp,"toString",(function(){return"[object Generator]"})),exports.keys=function(val){var object=Object(val),keys=[];for(var key in object)keys.push(key);return keys.reverse(),function next(){for(;keys.length;){var key=keys.pop();if(key in object)return next.value=key,next.done=!1,next}return next.done=!0,next}},exports.values=values,Context.prototype={constructor:Context,reset:function(skipTempReset){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!skipTempReset)for(var name in this)"t"===name.charAt(0)&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))&&(this[name]=void 0)},stop:function(){this.done=!0;var rootRecord=this.tryEntries[0].completion;if("throw"===rootRecord.type)throw rootRecord.arg;return this.rval},dispatchException:function(exception){if(this.done)throw exception;var context=this;function handle(loc,caught){return record.type="throw",record.arg=exception,context.next=loc,caught&&(context.method="next",context.arg=void 0),!!caught}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i],record=entry.completion;if("root"===entry.tryLoc)return handle("end");if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc"),hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0)}else{if(!hasFinally)throw new Error("try statement without catch or finally");if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}}}},abrupt:function(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}finallyEntry&&("break"===type||"continue"===type)&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc&&(finallyEntry=null);var record=finallyEntry?finallyEntry.completion:{};return record.type=type,record.arg=arg,finallyEntry?(this.method="next",this.next=finallyEntry.finallyLoc,ContinueSentinel):this.complete(record)},complete:function(record,afterLoc){if("throw"===record.type)throw record.arg;return"break"===record.type||"continue"===record.type?this.next=record.arg:"return"===record.type?(this.rval=this.arg=record.arg,this.method="return",this.next="end"):"normal"===record.type&&afterLoc&&(this.next=afterLoc),ContinueSentinel},finish:function(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc)return this.complete(entry.completion,entry.afterLoc),resetTryEntry(entry),ContinueSentinel}},catch:function(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if("throw"===record.type){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function(iterable,resultName,nextLoc){return this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc},"next"===this.method&&(this.arg=void 0),ContinueSentinel}},exports}module.exports=_regeneratorRuntime,module.exports.__esModule=!0,module.exports.default=module.exports})),runtime=regeneratorRuntime$1(),regenerator=runtime;try{regeneratorRuntime=runtime}catch(accidentalStrictMode){"object"==typeof globalThis?globalThis.regeneratorRuntime=runtime:Function("r","regeneratorRuntime = r")(runtime)}function n(n){for(var r=arguments.length,t=Array(r>1?r-1:0),e=1;e<r;e++)t[e-1]=arguments[e];throw Error("[Immer] minified error nr: "+n+(t.length?" "+t.map((function(n){return"'"+n+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function r(n){return!!n&&!!n[Q]}function t(n){var r;return!!n&&(function(n){if(!n||"object"!=typeof n)return!1;var r=Object.getPrototypeOf(n);if(null===r)return!0;var t=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return t===Object||"function"==typeof t&&Function.toString.call(t)===Z}(n)||Array.isArray(n)||!!n[L]||!!(null===(r=n.constructor)||void 0===r?void 0:r[L])||s(n)||v(n))}function i(n,r,t){void 0===t&&(t=!1),0===o(n)?(t?Object.keys:nn)(n).forEach((function(e){t&&"symbol"==typeof e||r(e,n[e],n)})):n.forEach((function(t,e){return r(e,t,n)}))}function o(n){var r=n[Q];return r?r.i>3?r.i-4:r.i:Array.isArray(n)?1:s(n)?2:v(n)?3:0}function u(n,r){return 2===o(n)?n.has(r):Object.prototype.hasOwnProperty.call(n,r)}function f(n,r,t){var e=o(n);2===e?n.set(r,t):3===e?(n.delete(r),n.add(t)):n[r]=t}function s(n){return X&&n instanceof Map}function v(n){return q&&n instanceof Set}function p(n){return n.o||n.t}function l(n){if(Array.isArray(n))return Array.prototype.slice.call(n);var r=rn(n);delete r[Q];for(var t=nn(r),e=0;e<t.length;e++){var i=t[e],o=r[i];!1===o.writable&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(r[i]={configurable:!0,writable:!0,enumerable:o.enumerable,value:n[i]})}return Object.create(Object.getPrototypeOf(n),r)}function d(n,e){return void 0===e&&(e=!1),y(n)||r(n)||!t(n)||(o(n)>1&&(n.set=n.add=n.clear=n.delete=h),Object.freeze(n),e&&i(n,(function(n,r){return d(r,!0)}),!0)),n}function h(){n(2)}function y(n){return null==n||"object"!=typeof n||Object.isFrozen(n)}function b(r){var t=tn[r];return t||n(18,r),t}function _(){return U}function j(n,r){r&&(b("Patches"),n.u=[],n.s=[],n.v=r)}function O(n){g(n),n.p.forEach(S),n.p=null}function g(n){n===U&&(U=n.l)}function w(n){return U={p:[],l:U,h:n,m:!0,_:0}}function S(n){var r=n[Q];0===r.i||1===r.i?r.j():r.O=!0}function P(r,e){e._=e.p.length;var i=e.p[0],o=void 0!==r&&r!==i;return e.h.g||b("ES5").S(e,r,o),o?(i[Q].P&&(O(e),n(4)),t(r)&&(r=M(e,r),e.l||x(e,r)),e.u&&b("Patches").M(i[Q].t,r,e.u,e.s)):r=M(e,i,[]),O(e),e.u&&e.v(e.u,e.s),r!==H?r:void 0}function M(n,r,t){if(y(r))return r;var e=r[Q];if(!e)return i(r,(function(i,o){return A(n,e,r,i,o,t)}),!0),r;if(e.A!==n)return r;if(!e.P)return x(n,e.t,!0),e.t;if(!e.I){e.I=!0,e.A._--;var o=4===e.i||5===e.i?e.o=l(e.k):e.o;i(3===e.i?new Set(o):o,(function(r,i){return A(n,e,o,r,i,t)})),x(n,o,!1),t&&n.u&&b("Patches").R(e,t,n.u,n.s)}return e.o}function A(e,i,o,a,c,s){if(r(c)){var v=M(e,c,s&&i&&3!==i.i&&!u(i.D,a)?s.concat(a):void 0);if(f(o,a,v),!r(v))return;e.m=!1}if(t(c)&&!y(c)){if(!e.h.F&&e._<1)return;M(e,c),i&&i.A.l||x(e,c)}}function x(n,r,t){void 0===t&&(t=!1),n.h.F&&n.m&&d(r,t)}function z(n,r){var t=n[Q];return(t?p(t):n)[r]}function I(n,r){if(r in n)for(var t=Object.getPrototypeOf(n);t;){var e=Object.getOwnPropertyDescriptor(t,r);if(e)return e;t=Object.getPrototypeOf(t)}}function k(n){n.P||(n.P=!0,n.l&&k(n.l))}function E(n){n.o||(n.o=l(n.t))}function R(n,r,t){var e=s(r)?b("MapSet").N(r,t):v(r)?b("MapSet").T(r,t):n.g?function(n,r){var t=Array.isArray(n),e={i:t?1:0,A:r?r.A:_(),P:!1,I:!1,D:{},l:r,t:n,k:null,o:null,j:null,C:!1},i=e,o=en;t&&(i=[e],o=on);var u=Proxy.revocable(i,o),a=u.revoke,f=u.proxy;return e.k=f,e.j=a,f}(r,t):b("ES5").J(r,t);return(t?t.A:_()).p.push(e),e}function D(e){return r(e)||n(22,e),function n(r){if(!t(r))return r;var e,u=r[Q],c=o(r);if(u){if(!u.P&&(u.i<4||!b("ES5").K(u)))return u.t;u.I=!0,e=F(r,c),u.I=!1}else e=F(r,c);return i(e,(function(r,t){u&&function(n,r){return 2===o(n)?n.get(r):n[r]}(u.t,r)===t||f(e,r,n(t))})),3===c?new Set(e):e}(e)}function F(n,r){switch(r){case 2:return new Map(n);case 3:return Array.from(n)}return l(n)}var G,U,W="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),X="undefined"!=typeof Map,q="undefined"!=typeof Set,B="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,H=W?Symbol.for("immer-nothing"):((G={})["immer-nothing"]=!0,G),L=W?Symbol.for("immer-draftable"):"__$immer_draftable",Q=W?Symbol.for("immer-state"):"__$immer_state",Z=""+Object.prototype.constructor,nn="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Object.getOwnPropertyNames,rn=Object.getOwnPropertyDescriptors||function(n){var r={};return nn(n).forEach((function(t){r[t]=Object.getOwnPropertyDescriptor(n,t)})),r},tn={},en={get:function(n,r){if(r===Q)return n;var e=p(n);if(!u(e,r))return function(n,r,t){var e,i=I(r,t);return i?"value"in i?i.value:null===(e=i.get)||void 0===e?void 0:e.call(n.k):void 0}(n,e,r);var i=e[r];return n.I||!t(i)?i:i===z(n.t,r)?(E(n),n.o[r]=R(n.A.h,i,n)):i},has:function(n,r){return r in p(n)},ownKeys:function(n){return Reflect.ownKeys(p(n))},set:function(n,r,t){var e=I(p(n),r);if(null==e?void 0:e.set)return e.set.call(n.k,t),!0;if(!n.P){var i=z(p(n),r),o=null==i?void 0:i[Q];if(o&&o.t===t)return n.o[r]=t,n.D[r]=!1,!0;if(function(n,r){return n===r?0!==n||1/n==1/r:n!=n&&r!=r}(t,i)&&(void 0!==t||u(n.t,r)))return!0;E(n),k(n)}return n.o[r]===t&&"number"!=typeof t&&(void 0!==t||r in n.o)||(n.o[r]=t,n.D[r]=!0,!0)},deleteProperty:function(n,r){return void 0!==z(n.t,r)||r in n.t?(n.D[r]=!1,E(n),k(n)):delete n.D[r],n.o&&delete n.o[r],!0},getOwnPropertyDescriptor:function(n,r){var t=p(n),e=Reflect.getOwnPropertyDescriptor(t,r);return e?{writable:!0,configurable:1!==n.i||"length"!==r,enumerable:e.enumerable,value:t[r]}:e},defineProperty:function(){n(11)},getPrototypeOf:function(n){return Object.getPrototypeOf(n.t)},setPrototypeOf:function(){n(12)}},on={};i(en,(function(n,r){on[n]=function(){return arguments[0]=arguments[0][0],r.apply(this,arguments)}})),on.deleteProperty=function(r,t){return on.set.call(this,r,t,void 0)},on.set=function(r,t,e){return en.set.call(this,r[0],t,e,r[0])};var un=function(){function e(r){var e=this;this.g=B,this.F=!0,this.produce=function(r,i,o){if("function"==typeof r&&"function"!=typeof i){var u=i;i=r;var a=e;return function(n){var r=this;void 0===n&&(n=u);for(var t=arguments.length,e=Array(t>1?t-1:0),o=1;o<t;o++)e[o-1]=arguments[o];return a.produce(n,(function(n){var t;return(t=i).call.apply(t,[r,n].concat(e))}))}}var f;if("function"!=typeof i&&n(6),void 0!==o&&"function"!=typeof o&&n(7),t(r)){var c=w(e),s=R(e,r,void 0),v=!0;try{f=i(s),v=!1}finally{v?O(c):g(c)}return"undefined"!=typeof Promise&&f instanceof Promise?f.then((function(n){return j(c,o),P(n,c)}),(function(n){throw O(c),n})):(j(c,o),P(f,c))}if(!r||"object"!=typeof r){if(void 0===(f=i(r))&&(f=r),f===H&&(f=void 0),e.F&&d(f,!0),o){var p=[],l=[];b("Patches").M(r,f,p,l),o(p,l)}return f}n(21,r)},this.produceWithPatches=function(n,r){if("function"==typeof n)return function(r){for(var t=arguments.length,i=Array(t>1?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];return e.produceWithPatches(r,(function(r){return n.apply(void 0,[r].concat(i))}))};var t,i,o=e.produce(n,r,(function(n,r){t=n,i=r}));return"undefined"!=typeof Promise&&o instanceof Promise?o.then((function(n){return[n,t,i]})):[o,t,i]},"boolean"==typeof(null==r?void 0:r.useProxies)&&this.setUseProxies(r.useProxies),"boolean"==typeof(null==r?void 0:r.autoFreeze)&&this.setAutoFreeze(r.autoFreeze)}var i=e.prototype;return i.createDraft=function(e){t(e)||n(8),r(e)&&(e=D(e));var i=w(this),o=R(this,e,void 0);return o[Q].C=!0,g(i),o},i.finishDraft=function(r,t){var i=(r&&r[Q]).A;return j(i,t),P(void 0,i)},i.setAutoFreeze=function(n){this.F=n},i.setUseProxies=function(r){r&&!B&&n(20),this.g=r},i.applyPatches=function(n,t){var e;for(e=t.length-1;e>=0;e--){var i=t[e];if(0===i.path.length&&"replace"===i.op){n=i.value;break}}e>-1&&(t=t.slice(e+1));var o=b("Patches").$;return r(n)?o(n,t):this.produce(n,(function(n){return o(n,t)}))},e}(),an=new un,fn=an.produce;an.produceWithPatches.bind(an),an.setAutoFreeze.bind(an),an.setUseProxies.bind(an),an.applyPatches.bind(an),an.createDraft.bind(an),an.finishDraft.bind(an);var produce=fn,eventemitter3=createCommonjsModule((function(module){var has=Object.prototype.hasOwnProperty,prefix="~";function Events(){}function EE(fn,context,once){this.fn=fn,this.context=context,this.once=once||!1}function addListener(emitter,event,fn,context,once){if("function"!=typeof fn)throw new TypeError("The listener must be a function");var listener=new EE(fn,context||emitter,once),evt=prefix?prefix+event:event;return emitter._events[evt]?emitter._events[evt].fn?emitter._events[evt]=[emitter._events[evt],listener]:emitter._events[evt].push(listener):(emitter._events[evt]=listener,emitter._eventsCount++),emitter}function clearEvent(emitter,evt){0==--emitter._eventsCount?emitter._events=new Events:delete emitter._events[evt]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(prefix=!1)),EventEmitter.prototype.eventNames=function(){var events,name,names=[];if(0===this._eventsCount)return names;for(name in events=this._events)has.call(events,name)&&names.push(prefix?name.slice(1):name);return Object.getOwnPropertySymbols?names.concat(Object.getOwnPropertySymbols(events)):names},EventEmitter.prototype.listeners=function(event){var evt=prefix?prefix+event:event,handlers=this._events[evt];if(!handlers)return[];if(handlers.fn)return[handlers.fn];for(var i=0,l=handlers.length,ee=new Array(l);i<l;i++)ee[i]=handlers[i].fn;return ee},EventEmitter.prototype.listenerCount=function(event){var evt=prefix?prefix+event:event,listeners=this._events[evt];return listeners?listeners.fn?1:listeners.length:0},EventEmitter.prototype.emit=function(event,a1,a2,a3,a4,a5){var evt=prefix?prefix+event:event;if(!this._events[evt])return!1;var args,i,listeners=this._events[evt],len=arguments.length;if(listeners.fn){switch(listeners.once&&this.removeListener(event,listeners.fn,void 0,!0),len){case 1:return listeners.fn.call(listeners.context),!0;case 2:return listeners.fn.call(listeners.context,a1),!0;case 3:return listeners.fn.call(listeners.context,a1,a2),!0;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),!0;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),!0;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),!0}for(i=1,args=new Array(len-1);i<len;i++)args[i-1]=arguments[i];listeners.fn.apply(listeners.context,args)}else{var j,length=listeners.length;for(i=0;i<length;i++)switch(listeners[i].once&&this.removeListener(event,listeners[i].fn,void 0,!0),len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;case 4:listeners[i].fn.call(listeners[i].context,a1,a2,a3);break;default:if(!args)for(j=1,args=new Array(len-1);j<len;j++)args[j-1]=arguments[j];listeners[i].fn.apply(listeners[i].context,args)}}return!0},EventEmitter.prototype.on=function(event,fn,context){return addListener(this,event,fn,context,!1)},EventEmitter.prototype.once=function(event,fn,context){return addListener(this,event,fn,context,!0)},EventEmitter.prototype.removeListener=function(event,fn,context,once){var evt=prefix?prefix+event:event;if(!this._events[evt])return this;if(!fn)return clearEvent(this,evt),this;var listeners=this._events[evt];if(listeners.fn)listeners.fn!==fn||once&&!listeners.once||context&&listeners.context!==context||clearEvent(this,evt);else{for(var i=0,events=[],length=listeners.length;i<length;i++)(listeners[i].fn!==fn||once&&!listeners[i].once||context&&listeners[i].context!==context)&&events.push(listeners[i]);events.length?this._events[evt]=1===events.length?events[0]:events:clearEvent(this,evt)}return this},EventEmitter.prototype.removeAllListeners=function(event){var evt;return event?(evt=prefix?prefix+event:event,this._events[evt]&&clearEvent(this,evt)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=prefix,EventEmitter.EventEmitter=EventEmitter,module.exports=EventEmitter}));function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(_e2){didErr=!0,err=_e2},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var initialValue={dependencies:[],state:"loading",value:null},ZoldyStoreImpl=function(){function ZoldyStoreImpl(){var _this=this,states=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},events=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];_classCallCheck$1(this,ZoldyStoreImpl),this.states=states,this.events=events,_defineProperty$1(this,"inProcess",!1),_defineProperty$1(this,"getState",(function(path){var _this$states$path;return null!==(_this$states$path=_this.states[path])&&void 0!==_this$states$path?_this$states$path:initialValue}))}return _createClass$1(ZoldyStoreImpl,[{key:"getEvents",value:function(){return this.events}},{key:"setEvents",value:function(events){this.events=events}},{key:"getValue",value:function(path){var _this$states$path2;return null===(_this$states$path2=this.states[path])||void 0===_this$states$path2?void 0:_this$states$path2.value}},{key:"addDependency",value:function(path,dependency){this.states=produce(this.states,(function(draft){var _draft$path;draft[path]=produce(null!==(_draft$path=draft[path])&&void 0!==_draft$path?_draft$path:initialValue,(function(d){d.dependencies.includes(dependency)||(d.dependencies=[].concat(_toConsumableArray(d.dependencies),[dependency]))}))}))}},{key:"hasDependency",value:function(path,dependency){var _this$states$path$dep,_this$states$path3;return(null!==(_this$states$path$dep=null===(_this$states$path3=this.states[path])||void 0===_this$states$path3?void 0:_this$states$path3.dependencies)&&void 0!==_this$states$path$dep?_this$states$path$dep:[]).includes(dependency)}},{key:"set",value:function(path,value){var _this2=this,_produce2=_slicedToArray(produce([this.states,this.events],(function(draft){_this2._recipeSet(path,value,draft)})),2),data=_produce2[0],events=_produce2[1];this.states=data,this.events=events}},{key:"getDependencies",value:function(path){var _this$states$path$dep2,_this$states$path4;return null!==(_this$states$path$dep2=null===(_this$states$path4=this.states[path])||void 0===_this$states$path4?void 0:_this$states$path4.dependencies)&&void 0!==_this$states$path$dep2?_this$states$path$dep2:[]}},{key:"setDependency",value:function(path,dependencies){this.states=produce(this.states,(function(draft){var _draft$path2;draft[path]=produce(null!==(_draft$path2=draft[path])&&void 0!==_draft$path2?_draft$path2:initialValue,(function(d){d.dependencies=dependencies}))}))}},{key:"_recipeReset",value:function(path,_ref){var _data$path$dependenci,_data$path,_ref2=_slicedToArray(_ref,2),data=_ref2[0],events=_ref2[1];path in data&&(data[path]=produce(data[path],(function(d){d.state="loading",d.value=null})));var _step,_iterator=_createForOfIteratorHelper(null!==(_data$path$dependenci=null===(_data$path=data[path])||void 0===_data$path?void 0:_data$path.dependencies)&&void 0!==_data$path$dependenci?_data$path$dependenci:[]);try{for(_iterator.s();!(_step=_iterator.n()).done;){var p=_step.value;this._recipeReset(p,[data,events])}}catch(err){_iterator.e(err)}finally{_iterator.f()}events.push([path,data[path]])}},{key:"_recipeSet",value:function(path,value,_ref3){var _states$path,_states$path$dependen,_states$path2,_ref4=_slicedToArray(_ref3,2),states=_ref4[0],events=_ref4[1];states[path]=produce(null!==(_states$path=states[path])&&void 0!==_states$path?_states$path:initialValue,(function(d){d.state="hasValue",d.value=value}));var _step2,_iterator2=_createForOfIteratorHelper(null!==(_states$path$dependen=null===(_states$path2=states[path])||void 0===_states$path2?void 0:_states$path2.dependencies)&&void 0!==_states$path$dependen?_states$path$dependen:[]);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var p=_step2.value;this._recipeReset(p,[states,events])}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}events.push([path,states[path]])}},{key:"reset",value:function(path){var _this3=this,_produce4=_slicedToArray(produce([this.states,this.events],(function(draft){_this3._recipeReset(path,draft)})),2),states=_produce4[0],events=_produce4[1];this.states=states,this.events=events}}]),ZoldyStoreImpl}(),ZoldySnapshotImpl=function(){function ZoldySnapshotImpl(cache,parent){_classCallCheck$1(this,ZoldySnapshotImpl),this.cache=cache,this.parent=parent,_defineProperty$1(this,"eventEmitter",void 0),this.eventEmitter=new eventemitter3}return _createClass$1(ZoldySnapshotImpl,[{key:"reset",value:function(path){var snapshot=this;return snapshot.getCacheState(path).flatPipe((function(){return snapshot.cache.reset(path),snapshot.parent?snapshot.parent.reset(path):mono.then()})).flatPipe((function(){return snapshot.emitEvents()}))}},{key:"emitEvents",value:function(){var _this4=this;return this.cache.getEvents().forEach((function(e){return _this4.eventEmitter.emit(e[0],e[1])})),this.cache.setEvents([]),mono.then()}},{key:"addDependency",value:function(path,dependency){var snapshot=this;return mono.fromCallback((function(){return snapshot.cache.addDependency(path,dependency),Void}))}},{key:"hasDependency",value:function(path,dependency){var snapshot=this;return mono.fromCallback((function(){return snapshot.cache.hasDependency(path,dependency)}))}},{key:"getDependencies",value:function(path){var snapshot=this;return flux.fromCallback(_asyncToGenerator(regenerator.mark((function _callee(){return regenerator.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.abrupt("return",snapshot.cache.getDependencies(path));case 1:case"end":return _context.stop()}}),_callee)}))))}},{key:"setCacheValue",value:function(path,value){var snapshot=this;return mono.fromCallback((function(){return snapshot.cache.set(path,value),Void}))}},{key:"getCacheState",value:function(path){var snapshot=this;return mono.just(path).pipe(snapshot.cache.getState).flatPipe((function(state){return"hasValue"!=state.state&&snapshot.parent?snapshot.parent.getCacheState(path):mono.just(snapshot.cache.getState(path))}))}},{key:"getState",value:function(_ref6){var _this5=this,get=_ref6.get,path=_ref6.path,snapshot=this;return snapshot.getCacheState(path).flatPipe((function(state){return"hasValue"==state.state?mono.just(state):_this5._get(path,get).then(snapshot.getCacheState(path))}))}},{key:"_get",value:function(path,get){var _this6=this,snapshot=this;return zoldyPathParentProvider.get().flatPipe((function(value){return value?_this6.addDependency(path,value).thenReturn(value):mono.just(value)})).flatPipe((function(oldPathParent){return zoldyPathParentProvider.define(path).then(get().flatPipe((function(v){return snapshot.setCacheValue(path,v).then(zoldyPathParentProvider.define(oldPathParent))})))})).flatPipe((function(){return snapshot.emitEvents()}))}},{key:"subscribe",value:function(path,callback){var snapshot=this;return mono.fromCallback((function(){return snapshot.eventEmitter.on(path,callback),callback})).flatPipe((function(cb){return mono.just((function(){return snapshot.eventEmitter.removeListener(path,cb),mono.then()}))}))}},{key:"set",value:function(_ref7){var path=_ref7.path,value=_ref7.value,snapshot=this;return snapshot.setCacheValue(path,value).then().flatPipe((function(){return snapshot.emitEvents()}))}}]),ZoldySnapshotImpl}(),getSnapshotOrThrow=function(zoldySnapshot){return null!=zoldySnapshot?mono.just(zoldySnapshot):mono.error(new Error("NotFound ZoldySnapshot"))},ZoldyAtomImpl=function(){function ZoldyAtomImpl(config){_classCallCheck$1(this,ZoldyAtomImpl),_defineProperty$1(this,"_default",void 0),_defineProperty$1(this,"path",void 0),this.path=config.path,this._default=config.default}return _createClass$1(ZoldyAtomImpl,[{key:"get",value:function(){return this.getState().pipe((function(s){return s.value}))}},{key:"getState",value:function(){var _this=this,path=this.path;return zoldySnapshotProvider.get().flatPipe(getSnapshotOrThrow).flatPipe((function(zoldySnapshot){return zoldySnapshot.getState({get:function(){return _this._default()},path:path})}))}},{key:"subscribe",value:function(callback){var path=this.path;return zoldySnapshotProvider.get().flatPipe(getSnapshotOrThrow).flatPipe((function(zoldySnapshot){return zoldySnapshot.subscribe(path,callback)}))}},{key:"reset",value:function(){var path=this.path;return zoldySnapshotProvider.get().flatPipe(getSnapshotOrThrow).flatPipe((function(zoldySnapshot){return zoldySnapshot.reset(path)}))}},{key:"set",value:function(value){var path=this.path;return zoldySnapshotProvider.get().flatPipe(getSnapshotOrThrow).flatPipe((function(zoldySnapshot){return zoldySnapshot.set({value:value,path:path})}))}}]),ZoldyAtomImpl}(),atom$1=function(config){return new ZoldyAtomImpl({default:function(){return config.default},path:config.path})};var _encode=function(fields,fieldNameArray,defualtValue){var arr,_fieldNameArray=_arrayWithHoles(arr=fieldNameArray)||_iterableToArray(arr)||_unsupportedIterableToArray$1(arr)||_nonIterableRest(),fieldName=_fieldNameArray[0],fieldNameArrayRest=_fieldNameArray.slice(1);if(fieldName){if("encode"in fields)return fields.encode;var field=Object.keys(fields).filter((function(_fieldName){return _fieldName==fieldName}))[0];return _encode(fields[field],fieldNameArrayRest,defualtValue)}return function(){return defualtValue}},ZoldyParamsImpl=function(){function ZoldyParamsImpl(path,fields){_classCallCheck$1(this,ZoldyParamsImpl),this.path=path,this.fields=fields}return _createClass$1(ZoldyParamsImpl,[{key:"encode",value:function(params){var _this=this;return this.path.replace(/(:\w+)/g,(function(param){var fieldNameArray=param.substring(1).split(".");return _encode(_this.fields,fieldNameArray,param)(params)}))}}]),ZoldyParamsImpl}(),atomfamily=function(config){return function(params){var paramsBuild=new ZoldyParamsImpl(config.path,config.params);return atom$1({default:config.default(params),path:paramsBuild.encode(params)})}},ZoldySelectorValueImpl=function(){function ZoldySelectorValueImpl(config){_classCallCheck$1(this,ZoldySelectorValueImpl),_defineProperty$1(this,"_get",void 0),_defineProperty$1(this,"path",void 0),this.path=config.path,this._get=config.get}return _createClass$1(ZoldySelectorValueImpl,[{key:"subscribe",value:function(callback){var path=this.path;return zoldySnapshotProvider.get().flatPipe(getSnapshotOrThrow).flatPipe((function(zoldySnapshot){return zoldySnapshot.subscribe(path,callback)}))}},{key:"getState",value:function(){var _this=this,path=this.path;return zoldySnapshotProvider.get().flatPipe(getSnapshotOrThrow).flatPipe((function(zoldySnapshot){return zoldySnapshot.getState({get:function(){return _this._get},path:path})}))}},{key:"get",value:function(){return this.getState().pipe((function(s){return s.value}))}},{key:"reset",value:function(){var path=this.path;return zoldySnapshotProvider.get().flatPipe(getSnapshotOrThrow).flatPipe((function(zoldySnapshot){return zoldySnapshot.reset(path)}))}}]),ZoldySelectorValueImpl}(),ZoldySelectorStateImpl=function(){function ZoldySelectorStateImpl(config,zoldyValue){_classCallCheck$1(this,ZoldySelectorStateImpl),this.zoldyValue=zoldyValue,_defineProperty$1(this,"_set",void 0),this._set=config.set}return _createClass$1(ZoldySelectorStateImpl,[{key:"path",get:function(){return this.zoldyValue.path}},{key:"getState",value:function(){return this.zoldyValue.getState()}},{key:"subscribe",value:function(callback){return this.zoldyValue.subscribe(callback)}},{key:"get",value:function(){return this.zoldyValue.get()}},{key:"set",value:function(value){return this._set(value)}},{key:"reset",value:function(){return this.zoldyValue.reset()}}]),ZoldySelectorStateImpl}(),selector$1=function(config){return"set"in config?new ZoldySelectorStateImpl(config,new ZoldySelectorValueImpl(config)):new ZoldySelectorValueImpl(config)};function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof$1(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}var ZoldyValue=_createClass$1((function ZoldyValue(){_classCallCheck$1(this,ZoldyValue),_defineProperty$1(this,"path",void 0)})),ZoldyState=function(_ZoldyValue){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}(ZoldyState,_ZoldyValue);var _super=_createSuper(ZoldyState);function ZoldyState(){return _classCallCheck$1(this,ZoldyState),_super.apply(this,arguments)}return _createClass$1(ZoldyState)}(ZoldyValue),index={atomFamily:atomfamily,atom:atom$1,selector:selector$1},atomFamily=atomfamily,atom=atom$1,selector=selector$1,selectorFamily=function(config){return function(params){var paramsBuild=new ZoldyParamsImpl(config.path,config.params);return selector$1("set"in config?{get:config.get(params),path:paramsBuild.encode(params),set:function(v){return config.set(params,v)}}:{get:config.get(params),path:paramsBuild.encode(params)})}};exports.ZoldyState=ZoldyState,exports.ZoldyValue=ZoldyValue,exports.atom=atom,exports.atomFamily=atomFamily,exports.createSnapshot=function(parent){return new ZoldySnapshotImpl(new ZoldyStoreImpl({}),parent)},exports.default=index,exports.getSnapshotOrThrow=getSnapshotOrThrow,exports.selector=selector,exports.selectorFamily=selectorFamily,exports.zoldyPathParentProvider=zoldyPathParentProvider,exports.zoldySnapshotProvider=zoldySnapshotProvider,Object.defineProperty(exports,"__esModule",{value:!0})}));
